# ポモドーロタイマーWebアプリ アーキテクチャ設計

## 1. 概要

本アプリはFlask（Python）＋HTML/CSS/JavaScriptで構築するポモドーロタイマーWebアプリです。添付UIモックのような美しいUIと、進捗記録・セッション管理などの機能を持ちます。

---

## 2. アーキテクチャ方針

### 2.1. レイヤ分離
- **バックエンド（Flask）**
  - タイマー進捗やセッション履歴などのデータ管理
  - 必要に応じてAPI（REST/JSON）を提供
  - ページのルーティング・テンプレートレンダリング
- **フロントエンド（HTML/CSS/JavaScript）**
  - UI描画（添付画像のようなデザイン）
  - タイマーのカウントダウン・進捗表示（主にJavaScriptで実装）
  - ユーザー操作（開始・リセットボタン等）の処理
  - 必要に応じてバックエンドと非同期通信（fetch/AJAX）

---

## 3. ディレクトリ構成（例）

```
project_root/
├── app.py                # Flaskアプリ本体
├── static/
│   ├── css/
│   │   └── style.css     # UI用CSS
│   └── js/
│       └── timer.js      # タイマー・UI制御用JS
├── templates/
│   └── index.html        # メイン画面テンプレート
└── (必要に応じてDBや設定ファイル)
```

---

## 4. 各層の役割

### Flask（バックエンド）
- `/` ルートで `index.html` を返す
- 進捗記録や履歴保存が必要な場合はAPIエンドポイント（例: `/api/progress`）を用意
- 必要に応じてセッション管理やユーザーごとのデータ保存

### HTML/CSS（ビュー）
- 添付画像のようなレイアウト・配色・フォントを再現
- 円形プログレスバーはSVGやCanvas、またはCSS＋JSで実装

### JavaScript（クライアントロジック）
- タイマーのカウントダウン・状態管理（作業中/休憩中/停止中）
- プログレスバーのアニメーション制御
- ボタン操作のハンドリング
- 必要に応じて進捗データをFlaskに送信（fetch/AJAX）

---

## 5. ユニットテスト容易性のための設計ポイント

- タイマーや進捗記録などのロジックは、外部依存を持たない純粋なPythonクラスとして実装
- 状態管理はEnum等で明示的にし、状態遷移のテストがしやすいようにする
- 副作用（sleepや現在時刻依存）は排除し、テスト時は時間経過を引数で受け取れるようにする
- DBや外部APIとのやりとりは依存性注入でモック化可能に
- テスト用のインターフェース（状態取得、リセット等）を用意
- FlaskやJSの層はロジック層を呼び出すだけの薄い層に分離

---

## 6. 拡張性

- ユーザーごとの進捗記録（DB連携）
- 設定画面（作業/休憩時間のカスタマイズ）
- 通知機能（Web Notification API）
- モバイル対応（レスポンシブデザイン）

---

## 7. サンプル設計イメージ

- `app.py`  
  - `/` → index.htmlを返す
  - `/api/progress` → 進捗データの保存・取得（必要に応じて）
- `timer.js`  
  - タイマー状態管理（作業/休憩/停止）
  - setIntervalでカウントダウン
  - プログレスバーの描画更新
  - ボタンイベント（開始・リセット）
- `pomodoro_timer.py`（ロジックのみ、外部依存なし）
- `test_pomodoro_timer.py`（pytest等でテストしやすい構成）

---

このアーキテクチャにより、UI/ロジック/データ管理が分離され、保守性・拡張性・テスト容易性の高いWebアプリを実現します。
